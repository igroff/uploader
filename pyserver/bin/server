#! /usr/bin/env bash
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
export XHOSTNAME=`hostname`
source $DIR/set-version.sh
which pythonbrew > /dev/null 2>&1
if [ ! $? -eq 0 ]; then
    echo NO BREW, BAILING!
    exit 10
fi
pythonbrew venv use .pyenv
export PYTHONPATH=`pwd`:$PYTHONPATH
if [ ! -n "$PORT" ]; then
    PORT=5000
fi
# default out interface binding to localhost only
if [ ! -n "$BIND_INTERFACE" ]; then
    BIND_INTERFACE=127.0.0.1
fi

case $1 in
    start)
		exec gunicorn --bind $BIND_INTERFACE:$PORT pyserver.core:app
    ;;
    stop)
        $DIR/stop-server
    ;;
    debug)
		pyserver/core.py start --port $PORT --host $BIND_INTERFACE
    ;;
    test)
		pyserver/core.py test
    ;;
    config)
        pyserver/core.py config
    ;;
    *)
        echo "usage: server [debug|start|stop|test|config]";;
esac
